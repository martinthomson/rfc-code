machine:
  python:
    version: 2.7.11
  ruby:
    version: 2.3.1
  environment:
    GOPATH: "${HOME}/${CIRCLE_PROJECT_REPONAME}/.go_workspace"
    mmark_src: github.com/miekg/mmark/mmark
    mmark: ./mmark

checkout:
  post:
    - git fetch origin gh-pages --depth 10

dependencies:
  pre:
    - pip install xml2rfc
    - head -1 -q *.md | grep '^\-\-\-' >/dev/null 2>&1 && gem install --no-doc kramdown-rfc2629
    - head -1 -q *.md | grep '^%%%' >/dev/null 2>&1 && go get "$mmark_src" && go build "$mmark_src"

test:
  override:
    - make

deployment:
  production:
    branch: /.*/
    commands:
      - make ghpages
